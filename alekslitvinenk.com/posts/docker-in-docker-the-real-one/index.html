<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.cad38325c948e1a0e96e.css">html{font-size:100}body{margin:0;color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:35px;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:540px;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:35px;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:35px;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.18.17"/><link rel="alternate" type="application/rss+xml" title="Blog by Alexander Litvineneko" href="/rss.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154957162-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-154957162-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5a9dabb0e2d895c2e5ae9c297de36442"/><title data-react-helmet="true">Docker in Docker. The real one - Blog by Alexander Litvineneko</title><meta data-react-helmet="true" name="description" content="I also used to employ my own building pipeline to deliver docker images and I got to learn that my $5 Digital Ocean machine was getting stuck from time to time, because all of its available disk space was eaten up by generated docker images. The irony was that all of these artefacts were transient and needed for the purpose of building the main artefact only. That was the first time I though how cool it’d be, if I could generate intermediary artefacts and keep them entirely within builder container and, once it stopped, all that garbage gets removed. But that would require launching one docker container inside the other one..."/><meta data-react-helmet="true" property="og:site_name" content="Docker in Docker. The real one - Blog by Alexander Litvineneko"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Docker in Docker. The real one - Blog by Alexander Litvineneko"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-e91e1cdbd91a4b9e8571.js"/><link as="script" rel="preload" href="/app-ccd58c5a2f2730c46dd8.js"/><link as="script" rel="preload" href="/styles-70fcddd426196ea513a1.js"/><link as="script" rel="preload" href="/netlify-identity-widget-e37a35e339457e643f79.js"/><link as="script" rel="preload" href="/commons-681c31ed8a0580eeae4a.js"/><link as="script" rel="preload" href="/webpack-runtime-70167fc35af78022b16f.js"/><link as="fetch" rel="preload" href="/page-data/posts/docker-in-docker-the-real-one/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Docker in Docker. The real one</h1><div class="Content-module--content__body--2TrQ-"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ebec29d9468615107f312394867898d3/e937d/preface.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAHUSU7gv//EABkQAQEAAwEAAAAAAAAAAAAAAAECABESIf/aAAgBAQABBQJtHtwdlRt4cJ8//8QAFxEAAwEAAAAAAAAAAAAAAAAAARASQf/aAAgBAwEBPwE1i//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAECAQE/AYf/xAAYEAACAwAAAAAAAAAAAAAAAAAAASAxof/aAAgBAQAGPwJlbH//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhYTH/2gAIAQEAAT8hJqsOzcKb1FB8iq3VzYbM5EAez//aAAwDAQACAAMAAAAQbP8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAABEhAf/aAAgBAwEBPxCwxqn/xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAECAQE/EFNHsP/EABwQAAICAgMAAAAAAAAAAAAAAAERAEEhMXHh8P/aAAgBAQABPxAfHzZK5YMGIMiSLYBJtTh1F3LZAvHFYwedW5//2Q=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ebec29d9468615107f312394867898d3/8ac56/preface.webp 240w,
/static/ebec29d9468615107f312394867898d3/d3be9/preface.webp 480w,
/static/ebec29d9468615107f312394867898d3/e46b2/preface.webp 960w,
/static/ebec29d9468615107f312394867898d3/a9a89/preface.webp 1024w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/ebec29d9468615107f312394867898d3/5a194/preface.jpg 240w,
/static/ebec29d9468615107f312394867898d3/8a430/preface.jpg 480w,
/static/ebec29d9468615107f312394867898d3/0781d/preface.jpg 960w,
/static/ebec29d9468615107f312394867898d3/e937d/preface.jpg 1024w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/jpeg"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ebec29d9468615107f312394867898d3/0781d/preface.jpg"
          alt="Theme image"
          title="Theme image"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h2 id="preface"><a href="#preface" aria-label="preface permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preface</h2>
<p>During my work on <a href="https://github.com/alekslitvinenk/docker-openvpn" target="_blank" rel="nofollow noopener noreferrer">dockOvpn</a> project I was wondering, if I could use nested Docker containers to have all-in-one mega service capable of acting as OpenVPN server as well as a client. That time I decided to go for single feature container, because I didn’t want to overload it with functionality and, at the same time, I aimed to keep it as simple as possible for the end user. I also used to employ my own building pipeline to deliver docker images and I got to learn that my $5 Digital Ocean machine was getting stuck from time to time, because all of its available disk space was eaten up by generated docker images. The irony was that all of these artefacts were transient and needed for the purpose of building the main artefact only. I’d be happy to get them displaced as soon as the main artefact was built. I tried to use complicated shell scripts but that approach was error prone and I kept getting my server stuck anyway. That was the first time I though how cool it’d be, if I could generate intermediary artefacts and keep them entirely within builder container and, once it stopped, all that garbage gets removed.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 23.121387283236995%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAx0lEQVQY04WPy24CMQxFnTix85jJvAtiWmnaVdkgsQDEmo9hU6lbPp8rFdjWOoos514/KLTeJ8YbOi8V++ykfmC9xZcW1F0cBIkhYmPcEyrvMY0Se9HW55W6wABqVpsnTWAUC4eFkUgtJaZXbI5d+5WbJcE5fNd/Tnhc5HFbg/W+wYBmjpTd5aPcttPP0v8u/XVuCR5Iq3UIjcfyaGfYWGcwDXvmN0VRiq+QTPLZ6XmVT3N1GNIuK0HHYqHT8jgM1JuAg+m/uAOItAzg71r6BQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ccb905a94072c4398716960cc766a196/8ac56/screen1.webp 240w,
/static/ccb905a94072c4398716960cc766a196/d3be9/screen1.webp 480w,
/static/ccb905a94072c4398716960cc766a196/e46b2/screen1.webp 960w,
/static/ccb905a94072c4398716960cc766a196/878c0/screen1.webp 1384w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/ccb905a94072c4398716960cc766a196/e4891/screen1.png 240w,
/static/ccb905a94072c4398716960cc766a196/0ce91/screen1.png 480w,
/static/ccb905a94072c4398716960cc766a196/b7c40/screen1.png 960w,
/static/ccb905a94072c4398716960cc766a196/6da63/screen1.png 1384w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ccb905a94072c4398716960cc766a196/b7c40/screen1.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span></p>
<h2 id="dind-the-convoluted-way"><a href="#dind-the-convoluted-way" aria-label="dind the convoluted way permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DinD, the convoluted way</h2>
<p>Before I began my experiments I had a chance to read this brilliant atricle, which strictly discouraged using Docker the way I was going to. Needless to say, it didn’t stop me and I decided to go on. I started from the scratch, i.e from official Docker-in-Docker image. From my understanding, it was intended to be used the standard way, namely to work with bind-mounted docker deamon socket from the host -v <br>
<code class="language-text">/var/run/docker.sock:/var/run/docker.sock</code>. They also have a dind version (tagged with dind postfix) with some lack of documentation though. For the sake of self-education as well as to get a more lite and simplified version I started playing around with a regular Docker version. I used the following steps to get working solution:</p>
<ol>
<li>
<p>Lets’s run DinD the old fashioned way:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker run --privileged -it docker:18.09.6</code></pre></div>
<p>and we immediately get to the container’s terminal:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1fc4926d88de7b590c2f70d2903d434b/a8ac0/screen2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 7.936507936507936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAYklEQVQI1zWKAQqEMAwE9ZKmaOM1TSIiVBS5/7/xWkEYlmWY4bur1GK3223ltFw1H+o/l0PZhVfppmpySZaXTZYtl0smmdl5CMRICfEhvMDcNlCiyC3o9NOaCSB+RkKMAPQH1MAF/y6JYxwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/1fc4926d88de7b590c2f70d2903d434b/8ac56/screen2.webp 240w,
/static/1fc4926d88de7b590c2f70d2903d434b/d3be9/screen2.webp 480w,
/static/1fc4926d88de7b590c2f70d2903d434b/e46b2/screen2.webp 960w,
/static/1fc4926d88de7b590c2f70d2903d434b/f992d/screen2.webp 1440w,
/static/1fc4926d88de7b590c2f70d2903d434b/ae1af/screen2.webp 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/1fc4926d88de7b590c2f70d2903d434b/e4891/screen2.png 240w,
/static/1fc4926d88de7b590c2f70d2903d434b/0ce91/screen2.png 480w,
/static/1fc4926d88de7b590c2f70d2903d434b/b7c40/screen2.png 960w,
/static/1fc4926d88de7b590c2f70d2903d434b/5a2b3/screen2.png 1440w,
/static/1fc4926d88de7b590c2f70d2903d434b/a8ac0/screen2.png 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/1fc4926d88de7b590c2f70d2903d434b/b7c40/screen2.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
</li>
<li>You’ll be surprised, but the docker deamon isn’t running and the attempt to call <code class="language-text">docker ps</code> results in:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e031ba6b7a10088f85303dc4941b9572/a8ac0/screen3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 10.846560846560847%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAZUlEQVQI1x2HUQ7CMAzF9kHbvDRp0m4sHeIAoN3/foxJlmUv8T3i3OMMe3XuptPl6Tq7bF4v1v/KZhrGQ+CVFHUwD8Bpic/R5vD3qnsnaWzGzS5DWxHNqAlIRAmUQQUod2TKj5x+6XkGwPNIRcUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/e031ba6b7a10088f85303dc4941b9572/8ac56/screen3.webp 240w,
/static/e031ba6b7a10088f85303dc4941b9572/d3be9/screen3.webp 480w,
/static/e031ba6b7a10088f85303dc4941b9572/e46b2/screen3.webp 960w,
/static/e031ba6b7a10088f85303dc4941b9572/f992d/screen3.webp 1440w,
/static/e031ba6b7a10088f85303dc4941b9572/ae1af/screen3.webp 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/e031ba6b7a10088f85303dc4941b9572/e4891/screen3.png 240w,
/static/e031ba6b7a10088f85303dc4941b9572/0ce91/screen3.png 480w,
/static/e031ba6b7a10088f85303dc4941b9572/b7c40/screen3.png 960w,
/static/e031ba6b7a10088f85303dc4941b9572/5a2b3/screen3.png 1440w,
/static/e031ba6b7a10088f85303dc4941b9572/a8ac0/screen3.png 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/e031ba6b7a10088f85303dc4941b9572/b7c40/screen3.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></li>
<li>
<p>Not a big deal, lets launch it ourselves:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">dockerd</code></pre></div>
<p>It doesn’t work this way either:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/bba33/screen4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 8.233731739707837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAbklEQVQI1xXKSw7CMAwA0Yqqpf7EsYmTNAiqIqEiWHD/4xE2T7OYIT0v5eP1m+1hunXX/HZ/pXhT282PJFfRXeMWKVOoGBpJQ85IDgOvskTmIpgCKHMVKkL+t3e8RzAOjfuNBqALF5xhPo3jdJ5+PnIIEE7u7x8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/8ac56/screen4.webp 240w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/d3be9/screen4.webp 480w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/e46b2/screen4.webp 960w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/f992d/screen4.webp 1440w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/e830a/screen4.webp 1506w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/e4891/screen4.png 240w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/0ce91/screen4.png 480w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/b7c40/screen4.png 960w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/5a2b3/screen4.png 1440w,
/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/bba33/screen4.png 1506w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/1f37ffbf67fc2784ba6f4fdabb65fb6a/b7c40/screen4.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
</li>
<li>
<p>Now, we can try running dockerd again. But this time lets run it in a separate shell so we can keep entering commands in the terminal:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">dockerd <span class="token operator">&amp;</span></code></pre></div>
<p>and you’ll see:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d9e7ed89a1fba4f645f25eed3c69a29c/f9aec/screen5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 16.511318242343542%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAmUlEQVQI1yXNXQ+CMAyF4cEEZGsVabsCihfKx2IwJsb//9ucMTlXb/LkGLotug28Eq9CU6A56KbnT8cx8CK8EEfyjBW4uvWZKXJj88zmubV2Z9p71OdFt4SVl5GmoX+Nw7uT2EscwoNpbrFDCOgIIDhUV/ry740Xxf7oBEEPXsALNtcmLUXPkD7d6RdBADsPUoO4Yl8kWZTVF0ZbDQUQS8aOAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/d9e7ed89a1fba4f645f25eed3c69a29c/8ac56/screen5.webp 240w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/d3be9/screen5.webp 480w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/e46b2/screen5.webp 960w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/f992d/screen5.webp 1440w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/dfb61/screen5.webp 1502w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/d9e7ed89a1fba4f645f25eed3c69a29c/e4891/screen5.png 240w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/0ce91/screen5.png 480w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/b7c40/screen5.png 960w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/5a2b3/screen5.png 1440w,
/static/d9e7ed89a1fba4f645f25eed3c69a29c/f9aec/screen5.png 1502w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/d9e7ed89a1fba4f645f25eed3c69a29c/b7c40/screen5.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
</li>
</ol>
<p>You can see this and other experiments on my <a href="https://www.youtube.com/channel/UCReFpQWnTYFLukxk3ULfbOA" target="_blank" rel="nofollow noopener noreferrer">Youtube channel</a>:</p>
<p><iframe width="100%" height="400" src="https://www.youtube.com/embed/b35zxtcuGq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<h2 id="dind-the-easy-way"><a href="#dind-the-easy-way" aria-label="dind the easy way permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DinD, the easy way</h2>
<p>The approach we described above has one major flaw: it’s hard to base real world services on it, since if anything crashes, we will have to start everything all over again and we can’t run our DinD recursively.<br>
Let’s containerise our solution. To keep long story short, I already did it, you can go and inspect this <a href="https://github.com/alekslitvinenk/dind" target="_blank" rel="nofollow noopener noreferrer">project</a>. Its Dockerfile is almost identical to what we did above.
<a href="https://github.com/alekslitvinenk/dind" target="_blank" rel="nofollow noopener noreferrer"><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 350px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 74.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACrElEQVQ4y51UX0hTURi/Mwihp+otopdeZL31EDkJoVfrvaclozfBIgKhSKUppSD6UAgqUm2g+WehKbZZzm3OuU2na2ubs7n/One33alTr7s75+ue4xT2YtqBy+/c3/fn/L5zvnMYpjgAgPnfURKrUChOCBFviF/1oYAqhQKWIYRl+QKS5QUkEzkZnz/CAxGjGb6SF9A90V96nDSRSDCMVCplOI4rI6TP560RDZDLA2zsIFhjBXBv5sEe4cHwZx+03hyMLG+D2sbB0GIGnCxAIBR9TWL3AMp6enqOVFZVVZEVJGQeim4O7yKAdfYg74zu4WlPFo860lhlYfH7mQTunk3gz5ak0KnPwEdD2Pu25vIlEjegmaDxTFNTE8XfHi9VOT46eCuU3N3/FedhJZJDS+Ec/u7m8IAthcdWMviLPYXfTMQKXfo0mBfsj0jMGgcXSvbSYDQe7yE1ePyBtuAOwE9vVphycTDj28azq9u4z7QFyomYoNRlYcwa1BFfo5jkqfxh6cFUVFRQQjM6QmW3Nzy56g6nQ8YADxpHGomqCOJ2bRw3jseg1xBHVoPuLvFdDYTKjretZKhUaoqFokrHslOxFEcgllogZY4spaFlMiZ0mXKgs/s/EJ+0eBCnthwxNDyvP/lf9G+avrp5UC+whUFbCjVPbsHAfHzLNtxxjdhN+mnJqQ1aX3+ULLKRpCvbzfrqKVcG+s0s7jcnhe75XZhbdD0jNrZYiVLZcrauh2I5c87gJ42Lhz4LB5qFyPL0beYi4bu73lHf8vLys10nu9VCy9EO9d784WazWv8hzBpMD2gFbI6qq6urO1syq9Va0kbu1fU2XzCuK3KS+3ek57/7JKCz9RWdN798caWjtfE6mdtmvlHlcrn8fAkf19ZSXPc4Trid1IbkXy/TX4ai2dOpeCEEAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/6d1241f87a352d9fcf45d84e025f34ce/8ac56/dind.webp 240w,
/static/6d1241f87a352d9fcf45d84e025f34ce/a3432/dind.webp 350w"
          sizes="(max-width: 350px) 100vw, 350px"
          type="image/webp"
        />
        <source
          srcset="/static/6d1241f87a352d9fcf45d84e025f34ce/e4891/dind.png 240w,
/static/6d1241f87a352d9fcf45d84e025f34ce/d6f3f/dind.png 350w"
          sizes="(max-width: 350px) 100vw, 350px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/6d1241f87a352d9fcf45d84e025f34ce/d6f3f/dind.png"
          alt="DinD"
          title="DinD"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span></a>
And now we can go forward and conduct another experiment.</p>
<h3 id="experiment-1-running-two-child-containers-within-dind"><a href="#experiment-1-running-two-child-containers-within-dind" aria-label="experiment 1 running two child containers within dind permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Experiment 1. Running two child containers within DinD</h3>
<p>This one is quite simple. We’re going to launch MySQL and very simplistic Nodejs app within our DinD container. It takes just a few steps:</p>
<ol>
<li>
<p>We start DinD:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker run --privileged -it <span class="token punctuation">\</span>
-p <span class="token number">80</span>:8080 <span class="token punctuation">\</span>
-p <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
alekslitvinenk/dind</code></pre></div>
<p>You’ll see:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e3d3abb91c83b3e964784d872d50b789/f9aec/screen6.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15.579227696404793%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAk0lEQVQI1yWNyQ7CMBBD05ZuM0mg2SaJwrFF3Tgh/v/TmArLB/sdbOHmlc7oN+vXYGcKG9ERyzdx9S8mzC061WsYJ6xEW4umbv66CbecdOb4tmGLfn3SXugo+RPDnjmE3bnF6KxV0pKkSqgSdNDV1TUhVPa63MGr8YFssJKNQfPbRSZ5QSPRIjoAM4AZ277l224Yfmx4DQ7kMKizAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/e3d3abb91c83b3e964784d872d50b789/8ac56/screen6.webp 240w,
/static/e3d3abb91c83b3e964784d872d50b789/d3be9/screen6.webp 480w,
/static/e3d3abb91c83b3e964784d872d50b789/e46b2/screen6.webp 960w,
/static/e3d3abb91c83b3e964784d872d50b789/f992d/screen6.webp 1440w,
/static/e3d3abb91c83b3e964784d872d50b789/dfb61/screen6.webp 1502w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/e3d3abb91c83b3e964784d872d50b789/e4891/screen6.png 240w,
/static/e3d3abb91c83b3e964784d872d50b789/0ce91/screen6.png 480w,
/static/e3d3abb91c83b3e964784d872d50b789/b7c40/screen6.png 960w,
/static/e3d3abb91c83b3e964784d872d50b789/5a2b3/screen6.png 1440w,
/static/e3d3abb91c83b3e964784d872d50b789/f9aec/screen6.png 1502w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/e3d3abb91c83b3e964784d872d50b789/b7c40/screen6.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span>
Pay attention to the port mapping: we need to list and map all the ports our child containers might use. It can be inconvenient now, but I’m thinking on automation already.</p>
</li>
<li>
<p>Having this container up and running, now let’s run MySQL container. Copy’n’Paste the following code into bash shell of the DinD container:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker run --name mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>password -d -p <span class="token number">3306</span>:3306 mysql</code></pre></div>
<p><strong>Note:</strong> please, never use password password as your real password. It’s okay only for this tutorial.</p>
</li>
<li>If we did everything right, you should see the following output in your console:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15.74074074074074%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAnElEQVQI1xWNbQuCMBSFhWLiNufd272bLU2kKM2UkPr//6wFD4fz5TynCC9vRk1PHzeiBXH2pz3EN4UF44q0eHez0INKqm6VRCGRS+LCVYfjsdBxwEcbtrwhnFy2pE9I3z9Z0e5Iq8fJhtXhbHRfM86YYKUocxZ+THgP9mqaDuACEqGhZAanooUzQtdwI7mVwglhq3yYqaDkuWv5A0xDD+weUxPKAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/6fafe555cfba5f94b245c468a32a80d6/8ac56/screen7.webp 240w,
/static/6fafe555cfba5f94b245c468a32a80d6/d3be9/screen7.webp 480w,
/static/6fafe555cfba5f94b245c468a32a80d6/e46b2/screen7.webp 960w,
/static/6fafe555cfba5f94b245c468a32a80d6/f992d/screen7.webp 1440w,
/static/6fafe555cfba5f94b245c468a32a80d6/ae1af/screen7.webp 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/6fafe555cfba5f94b245c468a32a80d6/e4891/screen7.png 240w,
/static/6fafe555cfba5f94b245c468a32a80d6/0ce91/screen7.png 480w,
/static/6fafe555cfba5f94b245c468a32a80d6/b7c40/screen7.png 960w,
/static/6fafe555cfba5f94b245c468a32a80d6/5a2b3/screen7.png 1440w,
/static/6fafe555cfba5f94b245c468a32a80d6/a8ac0/screen7.png 1512w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/6fafe555cfba5f94b245c468a32a80d6/b7c40/screen7.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span>
Now we should be able to connect to our database now. I used to use <a href="https://dbeaver.io/" target="_blank" rel="nofollow noopener noreferrer">DBeaver</a> which allows you to connect to and manipulate almost any database:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 505px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 110.89108910891088%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAADY0lEQVQ4y5WV227aQBCGeblKfaDeVbnsQ7SKqpab3kVtb6qqRSIVUk6EYDDGGGI7YBufbTAm4IWdzmzCqU3VFunD693h35md2aF0c3LyvCWdvzpTzl72e4MjuSMftVqtLaenp4JKpXJUrVYP1jZIUutlp9N5dV2vPytJV1cf1msGY38MgR/AYrGA//9w8X1rGO9Lqqa9Wy6XEEfxfRiGxSRNikWeFKsiL9Dmr9zFaTG09HuYjkA39NelRqNR5pwDirE0ibhhRfzTxZR/vZ7wke1xz3W54zg8DCPu+z4PgmBLhHOu5/GxO2brFQOl0zkuXVxclKfTKfR6Pab1VK72Tahe29DoxeD5IQSBDygEcRwLoig6AB3h+GRstYJms/kgmGUZGIbBut0uNwwdQs8Ctpzhed5DmqbgeS7i7eHvv3OEFUUBkiQ9CM5mM+Eh7sBt24Z8fg/ZLIcpbiTACIjJFMeTBPCcxUaPcPScrdfrnWCe54DesZYkcVnVQemPwPZS8OM5kguCJIc0W0B7EEKzrYLaVaCrqqAoCqfoyKltyLT77e0t6/c13huY0NVMGBg2jJwQhnYAlhOAZgYg913oDizo9gaAtkgfNE0TgvM8Qw9R8Pz8vOy6LsiyzFRVxZAtcBwbxuMxhjkRYeVZCrqVQl1xIfJtIPs9uO04LEjmDx5eXl6WKXvoOhuNRpwEfs1oiGBJ4fnhXJxs14kkiXkQxky1Cri5ae6SgmJsOBxy0zTh7u7uN0zCfHKefvMYsrQrG1wUgigM/wnH37FMJGUvy+ShZVlCEA2e5A9rQpCi3HqI1S7qEKGM/VFwI7rh8Z1TdBTlVpAOHtPPHktAGD51jhjBwdomZLwMjBrMQR3SwdIiGdFtobLBpiCe+2MSJRtKHtYuwXVdZ/P5fCdIIWMNMlwg97EhBFgOh+WxK5NEQPd44yGFTHnAZntcqtfrZbqHKMKoc5AYdZd/IQzJNuCeHzDG1tCW5WPqh2+pS+OOSzRaPQVucjDe4OH7NPFXWeItAZZ429pvSnhDytS+J5MJ0DngVuJvgKCWRNAazdPB05huE3UhaqrfpAI+XS3gzARoSEq5hH88L/D8Ghj/j3a7XcM7XaPnBnrHctjO05hA+1qnI9c+VuTahy/yj89VtfG9Un3xE/R3MR4P/cfwAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ac90525c609355887fd39b75f2201649/8ac56/screen8.webp 240w,
/static/ac90525c609355887fd39b75f2201649/d3be9/screen8.webp 480w,
/static/ac90525c609355887fd39b75f2201649/c5db7/screen8.webp 505w"
          sizes="(max-width: 505px) 100vw, 505px"
          type="image/webp"
        />
        <source
          srcset="/static/ac90525c609355887fd39b75f2201649/e4891/screen8.png 240w,
/static/ac90525c609355887fd39b75f2201649/0ce91/screen8.png 480w,
/static/ac90525c609355887fd39b75f2201649/af469/screen8.png 505w"
          sizes="(max-width: 505px) 100vw, 505px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ac90525c609355887fd39b75f2201649/af469/screen8.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.88487155090391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQ4y6WSXWvTUBjHw8RbwS1Ftu+z28Whu9uwzAmruCtBRl+u5pVfYOKdH8APIFTpBiJuXZImjWnTRPqSps1L27VNm5f25PEkVtlWB5v+4UfOSR5+nJPnId4/St05zX5YPT7Nrefz7BrNsBTDstTZGU2xLEfRNE1ls1kql8tRDMNE+9+Ee5Zl1zDreL96ePj2LhHffrFYlkqGYWigNlWoNhqgqnUw2yoYuga63oZWqxWBiy5hWRZ0Oh0YDAZQEsX2wcHrB8Tms71YqWo2NXMENe18KtV7iJNaSK4ZSKp30XDkIABAQRD8FZwp/g62bavJZHKF2N1Lksd0Q/v4tQo5xkBfhGFwVLSDI94Ocvww6A78ANcHYcLnVXAioeu6ajqdXiYSzxMkTF3NMnVQ5BJyR+dwKQGCUBX6riG8ATiO04yEW/GnpOe5mmlPIc8WUb1WB9fzIxzXg8lk8ssbHXA+c8In2zukHwoHLhQEESmyDIIgAMdxUC6XwfO82wnjWDj1Pc0celhYQqL4HX4oStTVfr//R3Rj4WZ8hxyPx5rRd4DhBMTzHFTwKTvdHvR6vfBn3074cGuXFCVFC2dK1w3kug60DAu0thHN18Ur36gp+2/ekU2JUauKhBvhTS7OXLgOc90MzpjMhI1UKrVMvHy1H/OccRf+M77vW5lMZoXY2Hh8/9vJyedCoVDG8LIsFyuVyhzhe57ni7j7xSs1vKIokiiKnxKJRIzAWcDcwyxhFv+RpZlj4ScXyI1FAdqXtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/f724494b16e04c5bc6b51744997d5a53/8ac56/screen9.webp 240w,
/static/f724494b16e04c5bc6b51744997d5a53/d3be9/screen9.webp 480w,
/static/f724494b16e04c5bc6b51744997d5a53/e46b2/screen9.webp 960w,
/static/f724494b16e04c5bc6b51744997d5a53/f992d/screen9.webp 1440w,
/static/f724494b16e04c5bc6b51744997d5a53/882b9/screen9.webp 1920w,
/static/f724494b16e04c5bc6b51744997d5a53/c5068/screen9.webp 2102w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/f724494b16e04c5bc6b51744997d5a53/e4891/screen9.png 240w,
/static/f724494b16e04c5bc6b51744997d5a53/0ce91/screen9.png 480w,
/static/f724494b16e04c5bc6b51744997d5a53/b7c40/screen9.png 960w,
/static/f724494b16e04c5bc6b51744997d5a53/5a2b3/screen9.png 1440w,
/static/f724494b16e04c5bc6b51744997d5a53/eff2e/screen9.png 1920w,
/static/f724494b16e04c5bc6b51744997d5a53/4389b/screen9.png 2102w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/f724494b16e04c5bc6b51744997d5a53/b7c40/screen9.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span></li>
<li>
<p>The next step we will launch a simple Nodejs app as a sibling to our MySQL container. Solely for this article I created an <a href="https://github.com/alekslitvinenk/hello-world-nodejs-server" target="_blank" rel="nofollow noopener noreferrer">App</a> that returns “Hello World!” string whenever it’s accessed via HTTP. Let’s run it:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker run -d --rm -p <span class="token number">8080</span>:8080 alekslitvinenk/hello-world-nodejs-server</code></pre></div>
<p>We get:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/bdfd28674eb8b0aad52d64df5a09bc26/bba33/screen10.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.811420982735726%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAmklEQVQI1w2MywrCMBAAezDvpMTuZjd9IRakFlt89uTR//8nA3OYwzAVb9i9qXtxfhCvRCuO35wWLJLvxFsq0A1wbmhDnKOJuqCDcmCqNJ3g0pRFiXCGvOVhH/qdi/SftnxpBV4Bl6Z9YrpGTzaw9eQs6Op4hunX12O0ULsUjEsusudgAtQtmMYLZYQuKKHEQQpppLRSGKGc+gOHSQ+Hh0p/GAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/bdfd28674eb8b0aad52d64df5a09bc26/8ac56/screen10.webp 240w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/d3be9/screen10.webp 480w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/e46b2/screen10.webp 960w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/f992d/screen10.webp 1440w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/e830a/screen10.webp 1506w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/bdfd28674eb8b0aad52d64df5a09bc26/e4891/screen10.png 240w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/0ce91/screen10.png 480w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/b7c40/screen10.png 960w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/5a2b3/screen10.png 1440w,
/static/bdfd28674eb8b0aad52d64df5a09bc26/bba33/screen10.png 1506w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/bdfd28674eb8b0aad52d64df5a09bc26/b7c40/screen10.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
</li>
<li>If we now go to localhost in our browser, we’ll see:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/12a5daa5a2d4734752159468ad474d12/3fdab/screen11.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 82.96296296296298%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVQ4y+2UTUuEQBzGp8PCduzeN+jSdSIIP0WH6tCtj7IFfQrv3k3QvJi6Gkq+HDomoqbgy2nVnWlmcEOiApe91Q+ew5/5Pw/PwDAAgDOwfHw4Mkz59MX3oW3bUNM0aFkWDMOQyXVdNgdB8DnTHSrDMKDjOFDX9RNBEA4A2DucBc9L7S16xWmWdVmWoSiKUJIkqKoqpqIoUJqmqCxLNud5znao4jhek7kn+1gUxXNA2H8vChMTurZd4xEIIaaf5hHMR25wRQPndV0bw0GPBqj/N42hPmr2PO+SNSTXMIcG/abFBKFNw28D8UTGgb7v/wf+zUC0BV/f4ZwEPg2BK6JuC7VD4AVr2DSNh3cA+YmuaeBMkqQbVVXvZVleKIpyO1HUsyD+O57njwHHcWCXfABoi2+D7QeJlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/12a5daa5a2d4734752159468ad474d12/8ac56/screen11.webp 240w,
/static/12a5daa5a2d4734752159468ad474d12/d3be9/screen11.webp 480w,
/static/12a5daa5a2d4734752159468ad474d12/e46b2/screen11.webp 960w,
/static/12a5daa5a2d4734752159468ad474d12/f992d/screen11.webp 1440w,
/static/12a5daa5a2d4734752159468ad474d12/3d6ef/screen11.webp 1890w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/12a5daa5a2d4734752159468ad474d12/e4891/screen11.png 240w,
/static/12a5daa5a2d4734752159468ad474d12/0ce91/screen11.png 480w,
/static/12a5daa5a2d4734752159468ad474d12/b7c40/screen11.png 960w,
/static/12a5daa5a2d4734752159468ad474d12/5a2b3/screen11.png 1440w,
/static/12a5daa5a2d4734752159468ad474d12/3fdab/screen11.png 1890w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/12a5daa5a2d4734752159468ad474d12/b7c40/screen11.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></li>
</ol>
<p><strong>Conclusion:</strong> We just ran 2 docker apps in another docker container and we can dispose these images altogether with their containers by simply stopping (and removing )parent container! You can see this experiment on YouTube as well:</p>
<p><iframe width="100%" height="400" src="https://www.youtube.com/embed/s8AK55jjUjQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<h3 id="experiment-2-recursive-docker-in-docker"><a href="#experiment-2-recursive-docker-in-docker" aria-label="experiment 2 recursive docker in docker permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Experiment 2. Recursive Docker in Docker</h3>
<p>This is a bit less practical, but nonetheless very interesting from scientific point of view, application of DinD. How deep can we get running DinD recursively? Let’s do the following experiment:</p>
<ol>
<li>
<p>In your terminal enter:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DIND_DEPTH</span><span class="token operator">=</span><span class="token number">0</span></code></pre></div>
<p>Lets 0 be the host level depth.</p>
</li>
<li>
<p>Run DinD with DIND_DEPTH environment variable:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker run — privileged -it <span class="token punctuation">\</span>
-e <span class="token assign-left variable">DIND_DEPTH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>DIND_DEPTH<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span> <span class="token punctuation">\</span>
alekslitvinenk/dind</code></pre></div>
<p>Here we capture current DIND_DEPTH value and calculate and increased by 1 value to pass it on to the inner container.</p>
</li>
<li>Let’s repeat the previous step 9 times.<br>
Notice that from now on, every time you paste the above code and hit Enter, DinD image gets pulled over and over again. This is happening because every time we launch DinD we create a totally new docker images and container store which is empty and doesn’t contain any images ad containers you ran on the upper (outer) level.</li>
<li>
<p>Let’s check our container local DIND_DEPTH variable:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">$DIND_DEPTH</span></code></pre></div>
<p>You’ll get:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 924px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1d19b852c1b558a39b4873a1d61859b4/96c16/screen12.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 17.532467532467532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAY0lEQVQI15WOSQqAMAxFG9sMHSjUViriSq/i/c9kENw6PMInf/FIDEWXuoRKoRHqvvi8+tBY01cyz1gafEEpKrPKYeI0i6YUpOReZM4YO29HH/ekFcD8ACxYHPSIvnD1ez5wApFhA9ykNLupAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/1d19b852c1b558a39b4873a1d61859b4/8ac56/screen12.webp 240w,
/static/1d19b852c1b558a39b4873a1d61859b4/d3be9/screen12.webp 480w,
/static/1d19b852c1b558a39b4873a1d61859b4/c3b05/screen12.webp 924w"
          sizes="(max-width: 924px) 100vw, 924px"
          type="image/webp"
        />
        <source
          srcset="/static/1d19b852c1b558a39b4873a1d61859b4/e4891/screen12.png 240w,
/static/1d19b852c1b558a39b4873a1d61859b4/0ce91/screen12.png 480w,
/static/1d19b852c1b558a39b4873a1d61859b4/96c16/screen12.png 924w"
          sizes="(max-width: 924px) 100vw, 924px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/1d19b852c1b558a39b4873a1d61859b4/96c16/screen12.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
</li>
</ol>
<p>So, we can assume our containers structure is as the following:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">DIND_DEPTH=0 (HOST)
— DIND_DEPTH=1 (CONTAINER)
— — DIND_DEPTH=2 (CONTAINER)
— — — DIND_DEPTH=3 (CONTAINER)
— — — — DIND_DEPTH=4 (CONTAINER)
— — — — — DIND_DEPTH=5 (CONTAINER)
— — — — — — DIND_DEPTH=6 (CONTAINER)
— — — — — — — DIND_DEPTH=7 (CONTAINER)
— — — — — — — — DIND_DEPTH=8 (CONTAINER)
— — — — — — — — — DIND_DEPTH=9 (CONTAINER)
— — — — — — — — — — DIND_DEPTH=10 (CONTAINER)</code></pre></div>
<p>Let’s check it’s true. We will be quitting container one by one and check our DIND_DEPTH variable:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">exit</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$DIND_DEPTH</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7ce66d74444108c3bf023c486d324544/bbd4b/screen13.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 27.45358090185676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAyUlEQVQY002QW24DIQxFZxUzGD8wBoZ5pImUpqnav+5/UzXtT66OrAtI9jXT+lHyIXYRMYoYoxdCEkSK44jgCnNwlnkJM8QXTdku21et91Tv2j+zG6/nT9m+rT10fQ50Fyef4mNGuxAgeIUpNU4rpz4edGOpnBo5UogYfXjABQiiw4AM2g+7FbtyPnnywPmo9ra3Rym3lPfVrtre1e/ZEptJR2konfSgYVqVpm644PS/KimNbeCFPyHGEaSz9hHQTk9HyBEW/4r4C2pLJU9GYMmFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/7ce66d74444108c3bf023c486d324544/8ac56/screen13.webp 240w,
/static/7ce66d74444108c3bf023c486d324544/d3be9/screen13.webp 480w,
/static/7ce66d74444108c3bf023c486d324544/e46b2/screen13.webp 960w,
/static/7ce66d74444108c3bf023c486d324544/f992d/screen13.webp 1440w,
/static/7ce66d74444108c3bf023c486d324544/57961/screen13.webp 1508w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/7ce66d74444108c3bf023c486d324544/e4891/screen13.png 240w,
/static/7ce66d74444108c3bf023c486d324544/0ce91/screen13.png 480w,
/static/7ce66d74444108c3bf023c486d324544/b7c40/screen13.png 960w,
/static/7ce66d74444108c3bf023c486d324544/5a2b3/screen13.png 1440w,
/static/7ce66d74444108c3bf023c486d324544/bbd4b/screen13.png 1508w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/7ce66d74444108c3bf023c486d324544/b7c40/screen13.png"
          alt="Screenshot"
          title="Screenshot"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span>
If keep doing so up to the host level, we’ll get the following values:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">8</span>
<span class="token number">7</span>
<span class="token number">6</span>
<span class="token number">5</span>
<span class="token number">4</span>
<span class="token number">3</span>
<span class="token number">2</span>
<span class="token number">1</span></code></pre></div>
<p>It’s remarkable!!!<br>
In theory, we could construct a very complex tree-like containerised application, but this exercise goes far beyond the purpose of this article. If you’re interested in this experiment — stay tuned, I’m going to publish a new video on my YouTube channel!</p>
<h2 id="summary"><a href="#summary" aria-label="summary permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h2>
<p>Docker in Docker is definitely a way to go, should you need to boost your staging environment or create a self-cleaning CICD pipeline. In many cases DinD may prove to be much more convenient than <a href="https://kubernetes.io/" target="_blank" rel="nofollow noopener noreferrer">Kubernetes</a> and <a href="https://jenkins-x.io/" target="_blank" rel="nofollow noopener noreferrer">Jenkins X</a>. But it comes with a few gotchas, to name but a few: bind-mounting directories inside you inner containers might not work as you expect (it might not work at all) (if you are interested — <a href="https://www.youtube.com/channel/UCReFpQWnTYFLukxk3ULfbOA/" target="_blank" rel="nofollow noopener noreferrer">subscribe</a>, I’ll cover this topic later); it’s still a purely research project, i.e everything you do with DinD comes with absolutely no warranty. I’d say if you’re a very small company or an individual — i is a totally viable solution. But as you grow you might want to consider more reliable and more industry standard solutions.</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->2 Dec 2019</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/docker/">Docker</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cicd/">CICD</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/kubernetes/">Kubernetes</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/testing/">Testing</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/web-service/">Web Service</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Software engineer, philosopher, enthusiast.<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/alekslitvinenk" rel="noopener noreferrer" target="_blank"><strong>Alexander Litvinenko</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/docker-in-docker-the-real-one/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ccd58c5a2f2730c46dd8.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-87ef582ba388a83f73c0.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-8bf6e18fcbffbee6eab5.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-a8a30d5821197c180923.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-324659d88459e32c19db.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-e91e1cdbd91a4b9e8571.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-7cf61ce2cc0ad5d23928.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-438077e52668404488ab.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-4a41e786118ee2b99a61.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-06c543fd0fd21a7ba643.js"]};/*]]>*/</script><script src="/webpack-runtime-70167fc35af78022b16f.js" async=""></script><script src="/commons-681c31ed8a0580eeae4a.js" async=""></script><script src="/netlify-identity-widget-e37a35e339457e643f79.js" async=""></script><script src="/styles-70fcddd426196ea513a1.js" async=""></script><script src="/app-ccd58c5a2f2730c46dd8.js" async=""></script><script src="/component---src-templates-post-template-js-e91e1cdbd91a4b9e8571.js" async=""></script></body></html>